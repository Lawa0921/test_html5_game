# å ´æ™¯å¼ç¶“ç‡Ÿç³»çµ±è¨­è¨ˆæ–‡æª”

## ä¸€ã€éŠæˆ²æ ¸å¿ƒæ¦‚å¿µ

### éŠæˆ²é¡å‹
**2.5D å ´æ™¯å¼å®¢æ£§ç¶“ç‡Ÿæ›æ©ŸéŠæˆ²**
- è¦–è§’ï¼šæ–œå‘ 2.5Dï¼ˆé¡ä¼¼ã€Šé£¢è’ã€‹ï¼‰
- æ¨¡å¼ï¼šæ¡Œé¢å¯µç‰© + ç¶“ç‡Ÿæ¨¡æ“¬
- é¢¨æ ¼ï¼šå®‹æœæ­¦ä¿  + å®¢æ£§ç¶“ç‡Ÿ

### é›™æ¨¡å¼è¨­è¨ˆ

#### å°è¦–çª—æ¨¡å¼ï¼ˆ300x400ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚
â”‚   [å®¢æ£§å¤–è§€]      â”‚  â† 2.5D æ–œå‘è¦–è§’
â”‚    ğŸ®æ‚…ä¾†å®¢æ£§     â”‚     æœƒéš¨é€²åº¦è®ŠåŒ–
â”‚                  â”‚
â”‚   [é–€å£æœ‰ç²¾éˆ]    â”‚
â”‚                  â”‚
â”‚ ğŸ’° 1,234  ğŸ“ˆ45/ç§’â”‚
â”‚ â° åˆæ™‚ (æ™´)     â”‚  â† æ™‚é–“é¡¯ç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å±•é–‹æ¨¡å¼ï¼ˆ900x650ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ® æ‚…ä¾†å®¢æ£§ - ä¸€æ¨“å¤§å»³  â° åˆæ™‚ä¸‰åˆ» (æ™´) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚         [2.5D å®¢æ£§å…§éƒ¨å ´æ™¯]             â”‚
â”‚                                        â”‚
â”‚   ğŸ‘” æŒæ«ƒ (æ«ƒå°)    [æ¨“æ¢¯]             â”‚
â”‚                                        â”‚
â”‚   ğŸ‘¨â€ğŸ³ å»šå¸« â†’ å»šæˆ¿   [æ¡Œå­] ğŸ‘¨â€ğŸ’¼æœå‹™å“¡  â”‚
â”‚                                        â”‚
â”‚   ğŸ’‚ ä¿é¢ (ç«™å´—)    [é–€]               â”‚
â”‚                                        â”‚
â”‚ [å»šæˆ¿] [å®¢æˆ¿] [å¾Œé™¢]  â† å ´æ™¯åˆ‡æ›       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒç³»çµ±æ¶æ§‹

### 2.1 æ™‚é–“ç³»çµ± (TimeManager)

#### æ™‚é–“å–®ä½
```javascript
{
  // å¤©å¹²åœ°æ”¯ç´€å¹´
  year: "é–‹ç¦§äºŒå¹´",

  // å¤©å¹²ç´€æ—¥ï¼ˆ60å¤©ä¸€å¾ªç’°ï¼‰
  day: {
    stem: "ç”²",  // å¤©å¹²ï¼šç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸
    branch: "å­", // åœ°æ”¯ï¼šå­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥
    count: 1      // ç•¶å‰æ˜¯ç¬¬å¹¾å¤©
  },

  // æ™‚è¾°ç³»çµ±ï¼ˆä¸€å¤©12å€‹æ™‚è¾°ï¼‰
  hour: {
    name: "åˆæ™‚",     // å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥
    index: 6,        // 0-11
    quarter: 2,      // ä¸€åˆ»ã€äºŒåˆ»ã€ä¸‰åˆ»ã€å››åˆ»
    realMinutes: 0   // å¯¦éš›æµé€åˆ†é˜ï¼ˆéŠæˆ²å…§1æ™‚è¾° = çœŸå¯¦5åˆ†é˜ï¼‰
  },

  // å¤©æ°£
  weather: "æ™´",  // æ™´ã€é™°ã€é›¨ã€é›ª

  // å­£ç¯€
  season: "æ˜¥"    // æ˜¥å¤ç§‹å†¬
}
```

#### æ™‚è¾°å°æ‡‰è¡¨
| æ™‚è¾° | æ™‚é–“ | èªªæ˜ | éŠæˆ²ç‹€æ…‹ |
|------|------|------|---------|
| å­æ™‚ | 23-01 | æ·±å¤œ | ä¼‘æ¯ |
| ä¸‘æ™‚ | 01-03 | æ·±å¤œ | ä¼‘æ¯ |
| å¯…æ™‚ | 03-05 | é»æ˜ | ä¼‘æ¯ |
| å¯æ™‚ | 05-07 | æ—¥å‡º | **é–‹å§‹ç‡Ÿæ¥­** |
| è¾°æ™‚ | 07-09 | æ—©æ™¨ | ç‡Ÿæ¥­ä¸­ |
| å·³æ™‚ | 09-11 | ä¸Šåˆ | ç‡Ÿæ¥­ä¸­ |
| åˆæ™‚ | 11-13 | æ­£åˆ | ç‡Ÿæ¥­ä¸­ |
| æœªæ™‚ | 13-15 | ä¸‹åˆ | ç‡Ÿæ¥­ä¸­ |
| ç”³æ™‚ | 15-17 | å‚æ™š | ç‡Ÿæ¥­ä¸­ |
| é…‰æ™‚ | 17-19 | æ—¥è½ | ç‡Ÿæ¥­ä¸­ |
| æˆŒæ™‚ | 19-21 | é»ƒæ˜ | **æ‰“çƒŠ** |
| äº¥æ™‚ | 21-23 | å¤œæ™š | ä¼‘æ¯ |

#### æ™‚é–“æµé€Ÿ
- **çœŸå¯¦æ™‚é–“ 1 åˆ†é˜ = éŠæˆ²å…§ 1 æ™‚è¾°** ï¼ˆå»ºè­°ï¼Œå¯èª¿æ•´ï¼‰
- **çœŸå¯¦æ™‚é–“ 12 åˆ†é˜ = éŠæˆ²å…§ 1 å¤©**
- **çœŸå¯¦æ™‚é–“ 2 å°æ™‚ = éŠæˆ²å…§ 10 å¤©**

---

### 2.2 è§’è‰²å°ˆé•·ç³»çµ±

#### è§’è‰²æŠ€èƒ½åˆ†é¡
```javascript
{
  // åŸºç¤å±¬æ€§
  name: "å­Ÿå››å¨˜",
  type: "chef",

  // å°ˆé•·è©•ç´šï¼ˆS > A > B > C > Dï¼‰
  skills: {
    cooking: "S",      // çƒ¹é£ª
    service: "C",      // æœå‹™
    combat: "B",       // æˆ°é¬¥
    medicine: "A",     // é†«ç™‚
    entertainment: "D", // å¨›æ¨‚
    management: "C",   // ç®¡ç†
    crafting: "B"      // è£½ä½œ
  },

  // å¯åŸ·è¡Œçš„å·¥ä½œé¡å‹
  canWork: [
    "kitchen",      // å»šæˆ¿å·¥ä½œ
    "lobby",        // å¤§å»³æœå‹™ï¼ˆä½æ•ˆï¼‰
    "medicine"      // ç°¡å–®é†«ç™‚
  ],

  // å·¥ä½œæ•ˆç‡åŠ æˆ
  workEfficiency: {
    kitchen: 2.5,   // 250% æ•ˆç‡
    lobby: 0.5,     // 50% æ•ˆç‡
    medicine: 1.5   // 150% æ•ˆç‡
  }
}
```

#### 10ä½è§’è‰²å°ˆé•·å®šç¾©

| è§’è‰² | çƒ¹é£ª | æœå‹™ | æˆ°é¬¥ | é†«ç™‚ | å¨›æ¨‚ | ç®¡ç† | è£½ä½œ | ä¸»è¦å·¥ä½œ |
|------|-----|------|-----|------|-----|------|-----|---------|
| ğŸ‘” æŒæ«ƒ | B | A | A | C | B | **S** | C | ç®¡ç†ã€æ¥å¾… |
| ğŸ‘¨â€ğŸ³ å»šå¸« | **S** | C | B | A | D | C | B | çƒ¹é£ªã€è—¥è†³ |
| ğŸ‘¨â€ğŸ’¼ æœå‹™å“¡ | C | **S** | D | D | A | B | D | æœå‹™ã€æ¥å¾… |
| ğŸ’‚ ä¿é¢ | D | D | **S** | C | C | B | C | æˆ°é¬¥ã€å®‰ä¿ |
| ğŸƒ è·‘å ‚ | D | A | B | D | C | C | D | è·‘è…¿ã€é›œå‹™ |
| âš—ï¸ è—¥å¸« | B | D | C | **S** | D | C | A | é†«ç™‚ã€ç…‰è—¥ |
| ğŸ“– èªªæ›¸äºº | D | B | C | D | **S** | A | D | å¨›æ¨‚ã€æƒ…å ± |
| ğŸµ æ¨‚å¸« | D | C | B | D | **S** | C | D | å¨›æ¨‚ã€ç´è— |
| ğŸ“Š è³¬æˆ¿ | C | C | D | D | D | **S** | C | ç®¡ç†ã€ç®—è³¬ |
| ğŸšª é–€ç«¥ | D | A | C | D | B | C | D | è¿è³“ã€é›œå‹™ |

---

### 2.3 å·¥ä½œèª¿åº¦ç³»çµ± (WorkScheduler)

#### å·¥ä½œå´—ä½å®šç¾©
```javascript
// å®¢æ£§å¯åˆ†é…çš„å·¥ä½œå´—ä½
const WORK_STATIONS = {
  lobby: {
    name: "å¤§å»³æ¥å¾…",
    location: { x: 200, y: 150 },  // å·¥ä½œä½ç½®
    maxWorkers: 2,                 // æœ€å¤š2äºº
    requiredSkills: ["service"],   // éœ€è¦æœå‹™æŠ€èƒ½
    workHours: [4, 19],           // å¯æ™‚åˆ°æˆŒæ™‚
    incomeBonus: 1.2              // æ”¶ç›ŠåŠ æˆ
  },

  kitchen: {
    name: "å»šæˆ¿çƒ¹é£ª",
    location: { x: 100, y: 200 },
    maxWorkers: 2,
    requiredSkills: ["cooking"],
    workHours: [4, 19],
    incomeBonus: 1.5
  },

  security: {
    name: "å®‰ä¿å·¡é‚",
    location: { x: 300, y: 100 },
    maxWorkers: 1,
    requiredSkills: ["combat"],
    workHours: [4, 22],  // å·¥ä½œåˆ°äº¥æ™‚
    incomeBonus: 1.0,
    patrolPath: [...]    // å·¡é‚è·¯å¾‘
  },

  entertainment: {
    name: "å¤§å»³å¨›æ¨‚",
    location: { x: 250, y: 180 },
    maxWorkers: 2,
    requiredSkills: ["entertainment"],
    workHours: [11, 19], // åˆæ™‚åˆ°æˆŒæ™‚
    incomeBonus: 1.3
  },

  medicine: {
    name: "è—¥æˆ¿",
    location: { x: 50, y: 100 },
    maxWorkers: 1,
    requiredSkills: ["medicine"],
    workHours: [7, 19],  // è¾°æ™‚åˆ°æˆŒæ™‚
    incomeBonus: 1.1
  },

  management: {
    name: "æ«ƒå°ç®¡ç†",
    location: { x: 200, y: 120 },
    maxWorkers: 1,
    requiredSkills: ["management"],
    workHours: [4, 19],
    incomeBonus: 1.4
  }
};
```

#### å·¥ä½œç‹€æ…‹æ©Ÿ
```javascript
å“¡å·¥ç‹€æ…‹ {
  IDLE: "é–’ç½®",      // ç„¡äº‹å¯åš
  WALKING: "ç§»å‹•ä¸­",  // å‰å¾€å·¥ä½œå´—ä½
  WORKING: "å·¥ä½œä¸­",  // æ­£åœ¨å·¥ä½œ
  RESTING: "ä¼‘æ¯ä¸­",  // å·¥ä½œé–“éš™ä¼‘æ¯
  SLEEPING: "ç¡çœ ä¸­", // æ™šä¸Šç¡è¦º
  EVENT: "äº‹ä»¶ä¸­"    // è§¸ç™¼ç‰¹æ®Šäº‹ä»¶
}
```

#### è‡ªå‹•æ’ç­é‚è¼¯
```javascript
function autoSchedule(employees, currentHour) {
  // 1. æª¢æŸ¥æ™‚é–“ï¼Œæ˜¯å¦åœ¨ç‡Ÿæ¥­æ™‚é–“
  if (currentHour < 4 || currentHour > 19) {
    return setAllEmployees("SLEEPING");
  }

  // 2. å„ªå…ˆåˆ†é…æ ¸å¿ƒå´—ä½
  const priorities = [
    "management",    // æŒæ«ƒå¿…é ˆæœ‰äºº
    "kitchen",       // å»šæˆ¿å¿…é ˆæœ‰äºº
    "lobby",         // å¤§å»³æœå‹™
    "security",      // å®‰ä¿
    "entertainment", // å¨›æ¨‚
    "medicine"       // è—¥æˆ¿
  ];

  // 3. æ ¹æ“šå°ˆé•·åŒ¹é…æœ€ä½³äººé¸
  priorities.forEach(station => {
    const bestMatch = findBestEmployee(employees, station);
    assignWork(bestMatch, station);
  });

  // 4. å‰©é¤˜å“¡å·¥è‡ªå‹•ä¼‘æ¯æˆ–åšé›œå‹™
}
```

---

### 2.4 å ´æ™¯ç³»çµ±é‡æ§‹

#### å ´æ™¯åˆ—è¡¨
```javascript
// å°è¦–çª—å ´æ™¯
ExteriorScene {
  key: "ExteriorScene",
  displayMode: "small",  // 300x400
  background: "exterior_level_1.png",  // æœƒæ ¹æ“šç­‰ç´šè®ŠåŒ–
  interactiveArea: {
    x: 0, y: 0, width: 300, height: 350
  },
  onClick: () => expandToInterior()
}

// å±•é–‹å ´æ™¯ - ä¸€æ¨“å¤§å»³
LobbyScene {
  key: "LobbyScene",
  displayMode: "large",  // 900x650
  background: "lobby_interior.png",

  // å¯äº¤äº’å€åŸŸ
  hotspots: [
    {
      id: "counter",
      name: "æ«ƒå°",
      bounds: { x: 200, y: 120, width: 100, height: 80 },
      onClick: () => showCounterMenu()
    },
    {
      id: "kitchen_door",
      name: "å»šæˆ¿å…¥å£",
      bounds: { x: 50, y: 180, width: 60, height: 80 },
      onClick: () => switchToScene("KitchenScene")
    },
    {
      id: "stairs",
      name: "æ¨“æ¢¯",
      bounds: { x: 700, y: 100, width: 80, height: 150 },
      onClick: () => switchToScene("SecondFloorScene")
    }
  ],

  // è§’è‰²ç”Ÿæˆé»
  spawnPoints: {
    manager: { x: 220, y: 130 },
    waiter: { x: 300, y: 200 },
    guard: { x: 400, y: 150 }
  }
}

// å…¶ä»–å ´æ™¯
KitchenScene      // å»šæˆ¿
RoomScene         // å®¢æˆ¿å€
YardScene         // å¾Œé™¢
SecondFloorScene  // äºŒæ¨“
```

---

### 2.5 è§’è‰²ç§»å‹•ç³»çµ±

#### Sprite ç®¡ç†
```javascript
class CharacterSprite {
  constructor(scene, character, x, y) {
    this.scene = scene;
    this.character = character;  // å¼•ç”¨ GameState ä¸­çš„è§’è‰²æ•¸æ“š

    // å‰µå»ºç²¾éˆï¼ˆç›®å‰ç”¨ä½”ä½åœ–ï¼‰
    this.sprite = scene.add.sprite(x, y, 'character_placeholder');
    this.sprite.setOrigin(0.5, 1);  // åº•éƒ¨ä¸­å¿ƒç‚ºéŒ¨é»

    // é¡¯ç¤ºåå­—
    this.nameText = scene.add.text(x, y - 60, character.name, {
      fontSize: '12px',
      color: '#ffffff',
      backgroundColor: '#000000',
      padding: { x: 4, y: 2 }
    }).setOrigin(0.5);

    // ç‹€æ…‹æŒ‡ç¤ºå™¨
    this.statusIcon = scene.add.sprite(x + 20, y - 50, 'status_working');

    // ç•¶å‰ç‹€æ…‹
    this.currentState = "IDLE";
    this.targetPosition = null;
    this.workStation = null;
  }

  // ç§»å‹•åˆ°ç›®æ¨™ä½ç½®
  moveTo(x, y, callback) {
    this.currentState = "WALKING";
    this.targetPosition = { x, y };

    // ä½¿ç”¨ Tween ç§»å‹•
    this.scene.tweens.add({
      targets: [this.sprite, this.nameText, this.statusIcon],
      x: x,
      y: y,
      duration: 2000,
      ease: 'Linear',
      onComplete: () => {
        this.currentState = "IDLE";
        if (callback) callback();
      }
    });
  }

  // é–‹å§‹å·¥ä½œ
  startWork(station) {
    this.workStation = station;
    this.currentState = "WORKING";
    this.statusIcon.setTexture('status_working');

    // æ’­æ”¾å·¥ä½œå‹•ç•«ï¼ˆå¾…å¯¦ç¾ï¼‰
    this.playAnimation('work_' + station.type);
  }

  // ä¼‘æ¯
  rest() {
    this.currentState = "RESTING";
    this.statusIcon.setTexture('status_resting');
    this.playAnimation('idle');
  }

  // ç¡è¦º
  sleep() {
    this.currentState = "SLEEPING";
    this.statusIcon.setTexture('status_sleeping');
    this.sprite.setAlpha(0.5);  // åŠé€æ˜è¡¨ç¤ºç¡çœ 
  }

  update(delta) {
    // æ›´æ–°é‚è¼¯ï¼ˆå‹•ç•«æ’­æ”¾ç­‰ï¼‰
  }
}
```

#### ç§»å‹•æ¨¡å¼
```javascript
// æ··åˆæ¨¡å¼ï¼šé‡è¦æ™‚åˆ»èµ°å‹•ï¼Œå¹³æ™‚å›ºå®š
const MovementMode = {
  STATIC: "static",         // éœæ…‹ç«™ä½ï¼ˆå¤§éƒ¨åˆ†æ™‚é–“ï¼‰
  PATROL: "patrol",         // å·¡é‚è·¯ç·šï¼ˆä¿é¢ï¼‰
  EVENT_DRIVEN: "event"     // äº‹ä»¶è§¸ç™¼ç§»å‹•
};

// è§¸ç™¼ç§»å‹•çš„äº‹ä»¶
const MovementEvents = [
  "ä¸Šç­",     // å¾ä¼‘æ¯å€èµ°åˆ°å·¥ä½œå´—ä½
  "ä¸‹ç­",     // å¾å·¥ä½œå´—ä½èµ°å›ä¼‘æ¯å€
  "åƒé£¯",     // å»å»šæˆ¿
  "å®¢äººä¾†è¨ª", // æœå‹™å“¡è¿æ¥å®¢äºº
  "éš¨æ©Ÿäº‹ä»¶"  // å±±è³Šä¾†è¥²ç­‰
];
```

---

## ä¸‰ã€æ•¸æ“šçµæ§‹è¨­è¨ˆ

### 3.1 GameState æ“´å±•
```javascript
class GameState {
  constructor() {
    // ... ç¾æœ‰å±¬æ€§ ...

    // æ–°å¢ï¼šæ™‚é–“ç³»çµ±
    this.time = {
      year: "é–‹ç¦§äºŒå¹´",
      day: { stem: "ç”²", branch: "å­", count: 1 },
      hour: { name: "å¯æ™‚", index: 4, quarter: 0 },
      weather: "æ™´",
      season: "æ˜¥"
    };

    // æ–°å¢ï¼šå·¥ä½œèª¿åº¦
    this.workSchedule = {
      lobby: [],      // åˆ†é…åˆ°å¤§å»³çš„å“¡å·¥ID
      kitchen: [],    // åˆ†é…åˆ°å»šæˆ¿çš„å“¡å·¥ID
      security: [],   // åˆ†é…åˆ°å®‰ä¿çš„å“¡å·¥ID
      entertainment: [],
      medicine: [],
      management: []
  };

    // æ–°å¢ï¼šå ´æ™¯ç‹€æ…‹
    this.currentScene = "ExteriorScene";
    this.sceneData = {
      lobbyLevel: 1,      // å¤§å»³ç­‰ç´šï¼ˆå½±éŸ¿èƒŒæ™¯åœ–ï¼‰
      kitchenLevel: 1,
      exteriorLevel: 1
    };

    // ä¿®æ”¹ï¼šå“¡å·¥æ•¸æ“šï¼ˆå¢åŠ å°ˆé•·å’Œç‹€æ…‹ï¼‰
    this.employees = this.initializeEmployeesWithSkills();
  }

  initializeEmployeesWithSkills() {
    return [
      {
        id: 0,
        name: 'æŒæ«ƒ',
        type: 'manager',
        unlocked: true,
        level: 1,

        // æ–°å¢ï¼šå°ˆé•·
        skills: {
          cooking: "B",
          service: "A",
          combat: "A",
          medicine: "C",
          entertainment: "B",
          management: "S",
          crafting: "C"
        },

        // æ–°å¢ï¼šå·¥ä½œç‹€æ…‹
        workStatus: {
          currentState: "IDLE",      // IDLE/WORKING/RESTING/SLEEPING
          assignedStation: "management",
          position: { x: 220, y: 130 },
          lastWorkTime: 0
        },

        // æ–°å¢ï¼šå·¥ä½œåå¥½
        preferredWork: ["management", "lobby"],

        // åŸæœ‰å±¬æ€§
        description: 'å®¢æ£§çš„ç®¡ç†è€…ï¼Œæå‡ç¸½é«”æ”¶å…¥',
        incomeBonus: 0.1,
        unlockCost: 0,
        upgradeCost: 100
      },
      // ... å…¶ä»–9å€‹å“¡å·¥ ...
    ];
  }

  // æ–°å¢æ–¹æ³•ï¼šåˆ†é…å·¥ä½œ
  assignWork(employeeId, stationId) {
    const employee = this.employees.find(e => e.id === employeeId);
    const station = WORK_STATIONS[stationId];

    // æª¢æŸ¥æ˜¯å¦æœ‰è©²æŠ€èƒ½
    const requiredSkill = station.requiredSkills[0];
    const skillLevel = employee.skills[requiredSkill];

    if (skillLevel === "D" || !skillLevel) {
      return { success: false, message: "è©²å“¡å·¥ä¸é©åˆæ­¤å·¥ä½œ" };
    }

    // æª¢æŸ¥å´—ä½æ˜¯å¦å·²æ»¿
    if (this.workSchedule[stationId].length >= station.maxWorkers) {
      return { success: false, message: "å·¥ä½œå´—ä½å·²æ»¿" };
    }

    // åˆ†é…å·¥ä½œ
    employee.workStatus.assignedStation = stationId;
    this.workSchedule[stationId].push(employeeId);

    return { success: true, message: `${employee.name}å·²åˆ†é…åˆ°${station.name}` };
  }

  // æ–°å¢æ–¹æ³•ï¼šè¨ˆç®—å·¥ä½œæ•ˆç‡
  calculateWorkEfficiency(employeeId) {
    const employee = this.employees.find(e => e.id === employeeId);
    const station = employee.workStatus.assignedStation;

    if (!station) return 1.0;

    const requiredSkill = WORK_STATIONS[station].requiredSkills[0];
    const skillLevel = employee.skills[requiredSkill];

    // æŠ€èƒ½ç­‰ç´šè½‰æ›ç‚ºæ•ˆç‡åŠ æˆ
    const efficiencyMap = {
      "S": 2.5,
      "A": 2.0,
      "B": 1.5,
      "C": 1.0,
      "D": 0.5
    };

    return efficiencyMap[skillLevel] || 1.0;
  }
}
```

---

## å››ã€è¦–è¦ºè³‡ç”¢éœ€æ±‚

### 4.1 å®¢æ£§å¤–è§€ï¼ˆå°è¦–çª—èƒŒæ™¯ï¼‰
```
éœ€è¦ç´ æï¼š
- exterior_level_1.png (åˆæœŸï¼šç°¡é™‹å°å®¢æ£§)
- exterior_level_2.png (3å€‹å¤¥ä¼´ï¼šå¢åŠ æ‹›ç‰Œ)
- exterior_level_3.png (5å€‹å¤¥ä¼´ï¼šäºŒå±¤æ¨“)
- exterior_level_4.png (7å€‹å¤¥ä¼´ï¼šä¸‰å±¤æ¨“)
- exterior_level_5.png (10å€‹å¤¥ä¼´ï¼šè±ªè¯å®¢æ£§)

å°ºå¯¸ï¼š300x350
è¦–è§’ï¼šæ–œå‘45åº¦
é¢¨æ ¼ï¼šå®‹æœå»ºç¯‰ + 2.5D
```

### 4.2 å®¢æ£§å…§éƒ¨å ´æ™¯
```
éœ€è¦ç´ æï¼š
- lobby_interior.png (ä¸€æ¨“å¤§å»³)
- kitchen_interior.png (å»šæˆ¿)
- room_interior.png (å®¢æˆ¿å€)
- yard_interior.png (å¾Œé™¢)
- floor2_interior.png (äºŒæ¨“)

å°ºå¯¸ï¼š900x550
è¦–è§’ï¼šæ–œå‘45åº¦
åŒ…å«ï¼š
- æ«ƒå°ã€æ¡Œæ¤…ã€æ¨“æ¢¯ç­‰å›ºå®šç‰©ä»¶
- ç†±å€æ¨™è¨˜ï¼ˆå¯é»æ“Šå€åŸŸï¼‰
```

### 4.3 è§’è‰²ç²¾éˆåœ–
```
éœ€è¦ç´ æï¼ˆæ¯å€‹è§’è‰²ï¼‰ï¼š
- character_name_idle.png (å¾…æ©Ÿå‹•ç•«ï¼Œ4å¹€)
- character_name_walk_down.png (å‘ä¸‹èµ°ï¼Œ4å¹€)
- character_name_walk_up.png (å‘ä¸Šèµ°ï¼Œ4å¹€)
- character_name_walk_left.png (å‘å·¦èµ°ï¼Œ4å¹€)
- character_name_walk_right.png (å‘å³èµ°ï¼Œ4å¹€)
- character_name_work.png (å·¥ä½œå‹•ç•«ï¼Œ4å¹€)

å°ºå¯¸ï¼š64x64 æ¯å¹€
æ•¸é‡ï¼š10å€‹è§’è‰² Ã— 6ç¨®å‹•ç•« = 60å€‹ç²¾éˆè¡¨
```

### 4.4 UI åœ–æ¨™
```
éœ€è¦ç´ æï¼š
- status_working.png (å·¥ä½œä¸­åœ–æ¨™)
- status_resting.png (ä¼‘æ¯ä¸­åœ–æ¨™)
- status_sleeping.png (ç¡çœ ä¸­åœ–æ¨™)
- time_sun.png (å¤ªé™½åœ–æ¨™)
- time_moon.png (æœˆäº®åœ–æ¨™)
- weather_icons.png (æ™´é›¨é›ªç­‰)
```

### 4.5 ä½”ä½åœ–æ–¹æ¡ˆ
```
åœ¨ç´ æç”Ÿæˆå‰ï¼Œå…ˆç”¨ç°¡å–®åœ–å½¢ä»£æ›¿ï¼š
- èƒŒæ™¯ï¼šç´”è‰² + ç¶²æ ¼ç·š
- è§’è‰²ï¼šå¸¶åå­—çš„åœ“å½¢
- åœ–æ¨™ï¼šemoji æˆ–æ–‡å­—

é€™æ¨£å¯ä»¥å…ˆå¯¦ç¾é‚è¼¯ï¼Œä¹‹å¾Œå¿«é€Ÿæ›¿æ›ç´ æ
```

---

## äº”ã€å¯¦ç¾å„ªå…ˆç´š

### Phase 1ï¼šæ ¸å¿ƒç³»çµ±ï¼ˆæœ¬é€±ï¼‰
âœ… 1. æ™‚é–“ç®¡ç†å™¨ (TimeManager)
âœ… 2. æ›´æ–° GameStateï¼ˆè§’è‰²å°ˆé•·ã€å·¥ä½œç‹€æ…‹ï¼‰
âœ… 3. å·¥ä½œèª¿åº¦ç³»çµ± (WorkScheduler)
âœ… 4. ç”¨ä½”ä½åœ–æ¸¬è©¦é‚è¼¯

### Phase 2ï¼šå ´æ™¯é‡æ§‹ï¼ˆä¸‹é€±ï¼‰
â³ 5. ExteriorSceneï¼ˆå®¢æ£§å¤–è§€ï¼Œå°è¦–çª—ï¼‰
â³ 6. LobbySceneï¼ˆä¸€æ¨“å¤§å»³ï¼Œå±•é–‹è¦–çª—ï¼‰
â³ 7. è§’è‰²ç²¾éˆç³»çµ±ï¼ˆéœæ…‹ç«™ä½ + ç°¡å–®ç§»å‹•ï¼‰
â³ 8. å ´æ™¯åˆ‡æ›é‚è¼¯

### Phase 3ï¼šé€²éšåŠŸèƒ½ï¼ˆç¬¬ä¸‰é€±ï¼‰
â³ 9. å…¶ä»–å ´æ™¯ï¼ˆå»šæˆ¿ã€å®¢æˆ¿ç­‰ï¼‰
â³ 10. ç²¾éˆå‹•ç•«ç³»çµ±
â³ 11. å¤©æ°£ã€å­£ç¯€è®ŠåŒ–
â³ 12. éš¨æ©Ÿäº‹ä»¶å ´æ™¯åŒ–

### Phase 4ï¼šç´ ææ•´åˆï¼ˆç¬¬å››é€±ï¼‰
â³ 13. æ›¿æ›æ‰€æœ‰ä½”ä½åœ–ç‚ºæ­£å¼ç´ æ
â³ 14. å‹•ç•«æ‰“ç£¨
â³ 15. éŸ³æ•ˆã€BGM
â³ 16. æœ€çµ‚æ¸¬è©¦

---

## å…­ã€æŠ€è¡“è¦é»

### 6.1 æ™‚é–“æµé€Ÿæ§åˆ¶
```javascript
class TimeManager {
  constructor() {
    this.timeScale = 1.0;  // æ™‚é–“å€é€Ÿï¼ˆå¯èª¿æ•´ï¼‰
    this.realTimePerHour = 60000;  // çœŸå¯¦1åˆ†é˜ = éŠæˆ²1æ™‚è¾°
  }

  // æš«åœæ™‚é–“
  pause() { this.timeScale = 0; }

  // åŠ é€Ÿæ™‚é–“ï¼ˆæ›æ©Ÿæ™‚ï¼‰
  speedUp(scale) { this.timeScale = scale; }

  // æ¢å¾©æ­£å¸¸é€Ÿåº¦
  normal() { this.timeScale = 1.0; }
}
```

### 6.2 è§’è‰² AI ç°¡åŒ–ç‰ˆ
```javascript
// å“¡å·¥ä¸éœ€è¦è¤‡é›œ AIï¼Œåªéœ€è¦ç‹€æ…‹æ©Ÿ
class EmployeeAI {
  update(employee, currentHour) {
    // 1. æª¢æŸ¥æ™‚é–“ï¼Œè©²ç¡è¦ºäº†å—ï¼Ÿ
    if (currentHour < 4 || currentHour > 21) {
      return "SLEEPING";
    }

    // 2. æœ‰åˆ†é…å·¥ä½œå—ï¼Ÿ
    if (employee.workStatus.assignedStation) {
      const station = WORK_STATIONS[employee.workStatus.assignedStation];

      // 3. åœ¨å·¥ä½œæ™‚é–“å…§å—ï¼Ÿ
      if (currentHour >= station.workHours[0] &&
          currentHour <= station.workHours[1]) {
        return "WORKING";
      }
    }

    // 4. å…¶ä»–æ™‚é–“ä¼‘æ¯
    return "RESTING";
  }
}
```

### 6.3 å ´æ™¯åˆ‡æ›å‹•ç•«
```javascript
switchToScene(newSceneKey) {
  // æ·¡å‡ºç•¶å‰å ´æ™¯
  this.cameras.main.fadeOut(300, 0, 0, 0);

  this.cameras.main.once('camerafadeoutcomplete', () => {
    // åˆ‡æ›å ´æ™¯
    this.scene.start(newSceneKey);
  });
}
```

---

## ä¸ƒã€é–‹ç™¼æ³¨æ„äº‹é …

### 7.1 æ€§èƒ½å„ªåŒ–
- å ´æ™¯ä¸­ç²¾éˆæ•¸é‡æ§åˆ¶åœ¨ 20 å€‹ä»¥å…§
- ä½¿ç”¨ç²¾éˆæ± ï¼ˆSprite Poolï¼‰ç®¡ç†è§’è‰²
- é›¢é–‹è¦–é‡çš„ç²¾éˆæš«åœæ›´æ–°

### 7.2 æ•¸æ“šæŒä¹…åŒ–
- æ™‚é–“æ•¸æ“šéœ€è¦å­˜æª”
- å·¥ä½œåˆ†é…éœ€è¦å­˜æª”
- è§’è‰²ä½ç½®éœ€è¦å­˜æª”

### 7.3 èª¿è©¦åŠŸèƒ½
```javascript
// é–‹ç™¼æ™‚çš„ä½œå¼ŠåŠŸèƒ½
this.debugPanel = {
  skipTime: (hours) => {},      // å¿«é€²æ™‚é–“
  teleportEmployee: (id, x, y) => {},  // å‚³é€å“¡å·¥
  setWeather: (weather) => {},  // æ”¹è®Šå¤©æ°£
  unlockAllEmployees: () => {}  // è§£é–æ‰€æœ‰å“¡å·¥
};
```

---

## å…«ã€å¾ŒçºŒæ“´å±•æ–¹å‘

1. **å¤šæ¨“å±¤ç³»çµ±**ï¼šäºŒæ¨“ã€ä¸‰æ¨“ã€åœ°ä¸‹å®¤
2. **å®¢äººç³»çµ±**ï¼šNPC å®¢äººé€²å…¥å®¢æ£§ï¼Œæ¶ˆè²»
3. **åŠ‡æƒ…äº‹ä»¶**ï¼šè§’è‰²èƒŒæ™¯æ•…äº‹è§£é–
4. **å°éŠæˆ²**ï¼šé‡£é­šã€æ¡è—¥ã€æ‰“çµ
5. **PVP ç³»çµ±**ï¼šå®¢æ£§ vs å®¢æ£§ï¼ˆï¼Ÿï¼‰

---

**æ–‡æª”ç‰ˆæœ¬**ï¼šv1.0
**å‰µå»ºæ—¥æœŸ**ï¼š2025-10-24
**æœ€å¾Œæ›´æ–°**ï¼š2025-10-24
