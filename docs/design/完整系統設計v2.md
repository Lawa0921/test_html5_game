# 悅來客棧 - 完整系統設計 v2.0

## 📋 目錄

1. [遊戲概述](#遊戲概述)
2. [現有系統分析](#現有系統分析)
3. [核心數據結構](#核心數據結構)
4. [系統架構設計](#系統架構設計)
5. [實作優先級](#實作優先級)

---

## 🎮 遊戲概述

### 核心定位
**桌面寵物 + 掛機經營 + 視覺小說** 的混合式遊戲

### 美術風格
**32-bit 像素風格**（全遊戲統一）

### 遊戲流程
```
開場故事（視覺小說）
    ↓
小介面（客棧外觀）→ 點擊展開
    ↓
大介面（客棧內部）
    ├── 場景切換（大廳、廚房、儲藏室、客房等）
    ├── 角色管理（雇用、配置、訓練）
    ├── 設施升級（科技樹）
    ├── 事件處理（劇情、隨機）
    └── 派遣任務（押標、行商）
```

---

## 🔍 現有系統分析

### ✅ 已完成的系統

| 系統 | 檔案 | 狀態 | 需要調整 |
|------|------|------|----------|
| 時間管理 | `TimeManager.js` | ✅ 完成 | 需擴展事件觸發 |
| 遊戲狀態 | `GameState.js` | ✅ 完成 | 需重構角色屬性 |
| 角色精靈 | `CharacterSprite.js` | ✅ 完成 | - |
| 外觀場景 | `ExteriorScene.js` | ✅ 完成 | 需加通知系統 |
| 大廳場景 | `LobbyScene.js` | ✅ 完成 | - |

### ❌ 需要新建的系統

1. **視覺小說系統** - 故事播放、立繪、對話框
2. **事件系統** - 隨機事件、劇情事件、選擇分支
3. **派遣系統** - 押標、行商、探險
4. **裝備系統** - 裝備管理、屬性加成
5. **科技樹系統** - 建築升級、科技研發
6. **好感度系統** - 角色關係、好感度影響
7. **學習系統** - 讀書、拜師、技能習得
8. **個性系統** - 主角個性、選擇影響
9. **通知系統** - 小介面事件提示
10. **場景系統擴展** - 廚房、儲藏室、客房場景

### 🔧 需要重構的系統

1. **角色屬性系統** - 從技能評級改為完整屬性
2. **員工系統** - 加入薪資、疲勞值、才能、技能

---

## 📊 核心數據結構

### 1. 主角數據 (Player)

```javascript
{
    // 基本資訊
    name: "未命名",           // 主角名字（遊戲中設定）
    age: 20,
    gender: "male",          // male/female

    // 核心屬性（0-100）
    attributes: {
        physique: 10,        // 體質（影響疲勞恢復、負重）
        strength: 10,        // 武力（影響戰鬥、護衛）
        intelligence: 10,    // 智慧（影響學習、研究）
        charisma: 10,        // 口才（影響談判、招待）
        dexterity: 10        // 靈巧（影響烹飪、製作）
    },

    // 個性系統（-100 到 +100）
    personality: {
        righteous: 0,        // 正義 ←→ 邪惡
        benevolent: 0,       // 仁慈 ←→ 冷酷
        cautious: 0,         // 謹慎 ←→ 冒險
        frugal: 0,           // 節儉 ←→ 奢侈
        humble: 0            // 謙遜 ←→ 傲慢
    },

    // 狀態
    status: {
        fatigue: 0,          // 疲勞值（0-100）
        health: 100,         // 健康值（0-100）
        mood: 50             // 心情（0-100）
    },

    // 裝備
    equipment: {
        weapon: null,        // 武器 ID
        armor: null,         // 護甲 ID
        accessory: null      // 配飾 ID
    },

    // 技能列表
    skills: [
        // { id: 'skill_001', level: 5, exp: 250 }
    ],

    // 經驗值
    experience: {
        total: 0,
        level: 1,
        nextLevelExp: 100
    }
}
```

### 2. 員工數據 (Employee)

```javascript
{
    // 基本資訊
    id: 0,
    name: "掌櫃",
    realName: "沈青山",
    type: "manager",
    portrait: "assets/portraits/manager.png",  // 立繪
    avatar: "assets/avatars/manager.png",      // 頭像

    // 背景故事
    story: {
        background: "...",   // 背景故事
        personality: "...",  // 性格描述
        preference: "..."    // 喜好
    },

    // 雇用狀態
    hired: {
        unlocked: true,      // 是否解鎖
        cost: 0,             // 雇用費用
        salary: 100,         // 每日薪資
        joinDate: 1          // 加入日期（遊戲天數）
    },

    // 核心屬性（0-100）
    attributes: {
        physique: 50,
        strength: 60,
        intelligence: 70,
        charisma: 80,
        dexterity: 40
    },

    // 成長率（1.0 = 正常，越高成長越快）
    growthRate: {
        physique: 1.0,
        strength: 1.2,
        intelligence: 1.5,
        charisma: 1.3,
        dexterity: 0.8
    },

    // 才能（影響工作表現和成長）
    talents: [
        {
            id: "talent_management",
            name: "天生領導",
            description: "管理工作效率+30%，智慧成長+20%",
            effects: {
                workBonus: { management: 0.3 },
                growthBonus: { intelligence: 0.2 }
            }
        }
    ],

    // 技能（主動/被動技能）
    skills: [
        {
            id: "skill_accounting",
            name: "精打細算",
            type: "passive",
            level: 3,
            exp: 450,
            maxLevel: 10,
            description: "客棧收入+5%",
            effects: { incomeBonus: 0.05 }
        }
    ],

    // 狀態
    status: {
        fatigue: 0,          // 疲勞值（0-100）
        health: 100,
        mood: 80,
        currentState: "IDLE" // IDLE/WORKING/RESTING/SLEEPING/MISSION
    },

    // 工作分配
    work: {
        assignedStation: null,       // 當前工作站
        workHours: 0,                // 今日工作時長
        efficiency: 1.0,             // 工作效率（受疲勞影響）
        experience: 0                // 工作經驗
    },

    // 裝備
    equipment: {
        weapon: null,
        armor: null,
        accessory: null
    },

    // 好感度系統
    affection: {
        level: 0,            // 好感度等級（0-100）
        points: 0,           // 好感度點數
        relationship: "stranger",  // stranger/acquaintance/friend/close_friend/lover

        // 好感度歷史事件
        events: [
            // { type: "gift", value: +5, date: 10, description: "收到禮物很開心" }
        ]
    },

    // 位置（2D場景）
    position: {
        scene: "lobby",      // 當前場景
        x: 220,
        y: 130
    }
}
```

### 3. 時間系統數據 (Time)

```javascript
{
    // 當前時間
    current: {
        year: "開禧二年",
        dayCount: 1,         // 總天數
        day: {
            stem: "甲",      // 天干
            branch: "子",    // 地支
            index: 0         // 60天循環索引
        },
        hour: {
            name: "卯時",
            index: 3,        // 0-11
            quarter: 0       // 0-3（一刻、二刻、三刻、四刻）
        },
        season: "春",        // 春/夏/秋/冬
        weather: "晴"        // 晴/陰/雨/雪
    },

    // 時間流速
    timeScale: 1.0,          // 倍速（可調整）

    // 營業時間
    businessHours: {
        open: 3,             // 卯時（05-07）
        close: 19            // 戌時（19-21）
    },

    // 特殊日期（節日、事件日）
    specialDays: [
        {
            dayIndex: 15,    // 每月15日
            type: "festival",
            name: "中秋節",
            effects: {
                customerBonus: 1.5,
                eventChance: 0.3
            }
        }
    ]
}
```

### 4. 事件系統數據 (Event)

```javascript
{
    // 事件定義
    id: "event_001",
    type: "random",          // random/story/quest/special

    // 觸發條件
    trigger: {
        probability: 0.1,    // 觸發概率
        conditions: [
            { type: "day", min: 5 },           // 至少第5天
            { type: "season", value: "春" },   // 春季
            { type: "weather", value: "晴" },  // 晴天
            { type: "time", hour: [6, 18] },   // 午時到酉時
            { type: "reputation", min: 50 },   // 名聲>=50
            { type: "employee", id: 0, present: true },  // 某員工在場
            { type: "affection", employeeId: 1, min: 30 }  // 某員工好感度>=30
        ]
    },

    // 事件內容
    content: {
        title: "江湖客到訪",
        description: "一名神秘的江湖客來到客棧...",

        // 立繪和表情
        characters: [
            {
                id: "npc_wanderer",
                portrait: "assets/events/wanderer.png",
                emotion: "serious"
            }
        ],

        // 對話序列
        dialogue: [
            {
                speaker: "npc_wanderer",
                text: "掌櫃的，來壺好酒！",
                emotion: "normal"
            },
            {
                speaker: "player",
                text: "這位客官請坐，小店只有這幾種...",
                emotion: "polite"
            }
        ],

        // 選擇分支
        choices: [
            {
                id: "choice_1",
                text: "熱情招待（消耗10銀兩）",
                conditions: [
                    { type: "silver", min: 10 }
                ],
                effects: {
                    silver: -10,
                    reputation: +5,
                    personality: { benevolent: +2 }
                },
                nextEventId: "event_001_a"
            },
            {
                id: "choice_2",
                text: "正常服務",
                effects: {
                    silver: +5
                },
                nextEventId: "event_001_b"
            },
            {
                id: "choice_3",
                text: "趕走此人（需要武力>=30）",
                conditions: [
                    { type: "attribute", name: "strength", min: 30 }
                ],
                effects: {
                    personality: { righteous: -5 }
                },
                nextEventId: "event_001_c"
            }
        ]
    },

    // 獎勵
    rewards: {
        silver: 100,
        reputation: 10,
        items: ["item_001"],
        unlockEmployee: 3  // 解鎖某個員工
    }
}
```

### 5. 裝備系統數據 (Equipment)

```javascript
{
    id: "eq_001",
    name: "青鋒劍",
    type: "weapon",          // weapon/armor/accessory
    rarity: "rare",          // common/uncommon/rare/epic/legendary
    icon: "assets/items/sword_001.png",

    // 基礎屬性加成
    attributes: {
        strength: +10,
        dexterity: +5
    },

    // 特殊效果
    effects: [
        {
            type: "combat_bonus",
            value: 0.15,
            description: "戰鬥力+15%"
        }
    ],

    // 技能附加
    skills: [
        {
            id: "skill_sword_master",
            name: "劍術精通",
            level: 1
        }
    ],

    // 取得方式
    obtainMethods: [
        "shop",              // 商店購買
        "quest",             // 任務獎勵
        "craft",             // 製作
        "event"              // 事件獲得
    ],

    // 價格
    price: {
        buy: 500,
        sell: 250
    },

    // 裝備需求
    requirements: {
        level: 5,
        attributes: {
            strength: 20
        }
    }
}
```

### 6. 派遣任務數據 (Mission)

```javascript
{
    id: "mission_001",
    name: "押標到臨安",
    type: "escort",          // escort/trade/explore/gather

    // 任務參數
    params: {
        destination: "臨安府",
        distance: 300,       // 里程
        duration: 3,         // 需要天數
        difficulty: "medium" // easy/medium/hard/extreme
    },

    // 需求
    requirements: {
        minEmployees: 2,     // 最少人數
        maxEmployees: 4,     // 最多人數
        requiredAttributes: {
            strength: 30,    // 總武力需求
            intelligence: 20
        },
        items: [             // 需要的物品
            { id: "item_map", quantity: 1 }
        ]
    },

    // 風險與收益
    risks: [
        {
            type: "bandit",
            probability: 0.3,
            description: "遭遇山賊",
            effects: {
                health: -20,
                silver: -100
            }
        }
    ],

    rewards: {
        silver: { min: 200, max: 500 },
        reputation: 20,
        items: [
            { id: "item_silk", probability: 0.6, quantity: [1, 3] }
        ],
        experience: 100
    },

    // 當前狀態（運行中的任務）
    status: {
        assigned: [0, 1, 3], // 派遣的員工ID
        startDay: 10,
        endDay: 13,
        progress: 0.5,       // 0-1
        events: [
            // 途中發生的事件記錄
        ]
    }
}
```

### 7. 科技樹數據 (Technology)

```javascript
{
    id: "tech_001",
    name: "客房擴建",
    category: "building",    // building/facility/recipe/skill

    // 前置需求
    prerequisites: {
        technologies: ["tech_000"],  // 需要先研發的科技
        reputation: 50,
        dayCount: 10,
        silver: 1000
    },

    // 研發成本
    cost: {
        silver: 2000,
        materials: [
            { id: "item_wood", quantity: 50 },
            { id: "item_stone", quantity: 30 }
        ],
        time: 5              // 建造天數
    },

    // 效果
    effects: {
        unlockScene: "room_c",  // 解鎖新場景
        maxCustomers: +10,      // 最大客人數+10
        incomeBonus: 0.2,       // 收入+20%
        unlockRecipes: ["recipe_001"]  // 解鎖新配方
    },

    // 狀態
    status: {
        unlocked: false,
        researching: false,
        completed: false,
        progress: 0          // 0-1
    }
}
```

### 8. 物品數據 (Item)

```javascript
{
    id: "item_001",
    name: "女兒紅",
    category: "ingredient",  // ingredient/material/gift/treasure
    rarity: "uncommon",
    icon: "assets/items/wine_001.png",
    stackable: true,
    maxStack: 99,

    // 用途
    usage: {
        consumable: true,
        giftable: true,      // 可送禮
        tradeable: true,     // 可交易
        craftable: false     // 可製作
    },

    // 送禮效果
    giftEffects: {
        affection: +10,
        mood: +5,

        // 特定角色偏好
        preferences: {
            0: 1.5,          // 員工ID 0 特別喜歡（1.5倍效果）
            2: 0.5           // 員工ID 2 不太喜歡（0.5倍效果）
        }
    },

    // 價格
    price: {
        buy: 50,
        sell: 25
    },

    // 季節性
    seasonal: {
        available: ["春", "夏"],  // 只在春夏有售
        priceMultiplier: {
            "春": 1.0,
            "夏": 1.2,
            "秋": 1.5,
            "冬": 2.0
        }
    }
}
```

### 9. 好感度事件數據 (AffectionEvent)

```javascript
{
    id: "affection_event_001",
    employeeId: 1,

    // 觸發條件
    trigger: {
        affectionLevel: 30,  // 好感度達到30
        season: "春",
        timeOfDay: "evening",
        playerPresent: true
    },

    // 事件內容
    content: {
        title: "月下對話",
        scene: "yard",       // 發生場景

        dialogue: [
            {
                speaker: "employee_1",
                text: "今晚月色真美...",
                emotion: "shy"
            }
        ],

        choices: [
            {
                text: "是啊，一起賞月吧",
                effects: {
                    affection: +5,
                    relationship: "friend"
                }
            },
            {
                text: "我還有事要忙",
                effects: {
                    affection: -2
                }
            }
        ]
    }
}
```

### 10. 學習系統數據 (Learning)

```javascript
{
    // 學習方式
    type: "study",           // study/apprentice/practice

    // 書籍學習
    study: {
        bookId: "book_001",
        skill: "intelligence",
        duration: 3,         // 需要天數
        cost: 50,            // 消耗（購買書籍）

        results: {
            attributeGain: { intelligence: +2 },
            skillUnlock: "skill_accounting"
        }
    },

    // 拜師學習
    apprentice: {
        teacherId: 0,        // 師傅（員工ID或NPC ID）
        skill: "combat",

        requirements: {
            affection: 50,   // 需要好感度
            silver: 100      // 學費
        },

        duration: 7,

        results: {
            attributeGain: { strength: +5 },
            skillUnlock: "skill_sword_basic",
            affection: +10   // 師徒關係+10
        }
    },

    // 實踐學習（工作中成長）
    practice: {
        workType: "cooking",
        expGain: 10,         // 每天經驗

        milestones: [
            { exp: 100, reward: { dexterity: +1 } },
            { exp: 500, reward: { skillUnlock: "skill_cooking_advanced" } }
        ]
    }
}
```

---

## 🏗️ 系統架構設計

### 系統層次圖

```
┌─────────────────────────────────────────┐
│         Presentation Layer              │
│  (Phaser Scenes - UI/Graphics)          │
├─────────────────────────────────────────┤
│         Game Logic Layer                │
│  ┌──────────┬──────────┬──────────┐    │
│  │Event Mgr │Mission   │Affection │    │
│  │          │System    │System    │    │
│  ├──────────┼──────────┼──────────┤    │
│  │Time Mgr  │Tech Tree │Learning  │    │
│  │          │          │System    │    │
│  ├──────────┼──────────┼──────────┤    │
│  │Equipment │Story     │Notify    │    │
│  │System    │System    │System    │    │
│  └──────────┴──────────┴──────────┘    │
├─────────────────────────────────────────┤
│         Data Layer                      │
│  (GameState - Central State Manager)    │
├─────────────────────────────────────────┤
│         Storage Layer                   │
│  (LocalStorage - Save/Load)             │
└─────────────────────────────────────────┘
```

### 核心管理器類別

#### 1. GameState（中央狀態管理器）

```javascript
class GameState {
    constructor() {
        // 玩家
        this.player = new Player();

        // 員工列表
        this.employees = [];

        // 客棧
        this.inn = {
            name: "悅來客棧",
            reputation: 0,
            silver: 500,

            // 設施等級
            facilities: {
                lobby: 1,
                kitchen: 1,
                storage: 1,
                room_a: 1,
                room_b: 0  // 未解鎖
            }
        };

        // 庫存
        this.inventory = new Inventory();

        // 任務系統
        this.missions = [];

        // 科技樹
        this.technologies = [];

        // 事件歷史
        this.events = [];

        // 統計
        this.stats = {};
    }
}
```

#### 2. EventManager（事件管理器）

```javascript
class EventManager {
    constructor(gameState, timeManager) {
        this.gameState = gameState;
        this.timeManager = timeManager;
        this.eventPool = [];        // 所有事件定義
        this.activeEvents = [];     // 當前活動事件
        this.eventHistory = [];     // 歷史事件
    }

    // 檢查事件觸發
    checkTriggers() {
        // 每個時辰檢查一次
        // 根據概率和條件決定是否觸發
    }

    // 觸發事件
    triggerEvent(eventId) {
        // 播放事件
        // 記錄到歷史
    }

    // 處理選擇
    handleChoice(eventId, choiceId) {
        // 應用效果
        // 改變遊戲狀態
        // 觸發後續事件
    }
}
```

#### 3. StoryManager（故事管理器）

```javascript
class StoryManager {
    constructor() {
        this.currentStory = null;
        this.storyProgress = {};
    }

    // 播放故事
    playStory(storyId) {
        // 載入故事數據
        // 切換到故事場景
        // 顯示立繪和對話
    }

    // 推進對話
    nextDialogue() {
        // 顯示下一句對話
        // 處理選擇分支
    }
}
```

#### 4. MissionManager（派遣管理器）

```javascript
class MissionManager {
    constructor(gameState, timeManager) {
        this.gameState = gameState;
        this.timeManager = timeManager;
        this.availableMissions = [];
        this.activeMissions = [];
    }

    // 開始任務
    startMission(missionId, employeeIds) {
        // 驗證需求
        // 扣除資源
        // 員工狀態改為 MISSION
        // 設定完成時間
    }

    // 更新任務進度
    updateMissions() {
        // 每日檢查
        // 隨機事件
        // 完成時發放獎勵
    }
}
```

#### 5. AffectionManager（好感度管理器）

```javascript
class AffectionManager {
    constructor(gameState) {
        this.gameState = gameState;
    }

    // 增加好感度
    addAffection(employeeId, points, reason) {
        // 應用倍率（才能、物品偏好）
        // 更新等級
        // 觸發好感度事件
    }

    // 檢查關係變化
    checkRelationshipChange(employee) {
        // 根據好感度更新關係
        // stranger -> acquaintance -> friend -> close_friend -> lover
    }
}
```

#### 6. LearningManager（學習管理器）

```javascript
class LearningManager {
    constructor(gameState) {
        this.gameState = gameState;
        this.activeStudies = [];  // 正在學習的
    }

    // 開始學習
    startLearning(targetId, type, config) {
        // study/apprentice/practice
        // 驗證條件
        // 記錄開始時間
    }

    // 完成學習
    completeLearning(studyId) {
        // 應用成果
        // 增加屬性/技能
    }
}
```

#### 7. TechnologyManager（科技管理器）

```javascript
class TechnologyManager {
    constructor(gameState) {
        this.gameState = gameState;
        this.tree = [];              // 科技樹
        this.researching = null;     // 當前研發
    }

    // 開始研發
    startResearch(techId) {
        // 驗證前置需求
        // 扣除資源
        // 設定完成時間
    }

    // 完成研發
    completeResearch(techId) {
        // 解鎖效果
        // 解鎖新場景/配方/技能
    }
}
```

#### 8. NotificationManager（通知管理器）

```javascript
class NotificationManager {
    constructor() {
        this.notifications = [];
        this.unreadCount = 0;
    }

    // 添加通知
    addNotification(type, message, data) {
        // type: event/mission/affection/levelup/etc
        // 儲存通知
        // 小介面顯示提示
    }

    // 標記已讀
    markAsRead(notificationId) {
        // 更新未讀數
    }
}
```

### 場景系統擴展

```javascript
// 新增場景
class KitchenScene extends Phaser.Scene {
    // 廚房場景
    // 顯示廚師工作
    // 配方研發
}

class StorageScene extends Phaser.Scene {
    // 儲藏室場景
    // 物品管理
    // 倉庫升級
}

class RoomScene extends Phaser.Scene {
    // 客房場景
    // 客人住宿
    // 房間升級
}

class YardScene extends Phaser.Scene {
    // 庭院場景
    // 員工休息
    // 訓練場地
}

class StoryScene extends Phaser.Scene {
    // 視覺小說場景
    // 立繪顯示
    // 對話框
    // 選擇按鈕
}
```

---

## 📅 實作優先級

### Phase 1: 核心系統重構（1-2週）

**優先級：🔴 最高**

1. ✅ **角色屬性系統重構**
   - 從技能評級改為完整屬性（體質、武力、智慧、口才、靈巧）
   - 加入疲勞值、心情、健康值
   - 更新 `GameState.js` 員工結構

2. ✅ **主角系統**
   - 創建 `Player.js` 類別
   - 個性系統數據結構
   - 整合到 GameState

3. ✅ **薪資系統**
   - 每日自動扣除薪資
   - 銀兩不足時的處理

4. ✅ **裝備系統基礎**
   - 創建 `EquipmentManager.js`
   - 裝備數據定義
   - 裝備穿脫邏輯
   - 屬性加成計算

### Phase 2: 視覺小說系統（1週）

**優先級：🔴 最高**

5. ✅ **StoryScene 場景**
   - 對話框 UI
   - 立繪顯示系統
   - 文字逐字顯示效果
   - 選擇按鈕

6. ✅ **StoryManager**
   - 故事數據載入
   - 分支邏輯
   - 存檔點

7. ✅ **開場故事**
   - 撰寫開場劇本
   - 製作開場立繪（或佔位圖）

### Phase 3: 事件系統（1-2週）

**優先級：🟡 高**

8. ✅ **EventManager**
   - 事件池管理
   - 觸發條件檢查
   - 概率計算

9. ✅ **事件數據庫**
   - 隨機事件（至少10個）
   - 劇情事件（主線）
   - 好感度事件

10. ✅ **通知系統**
    - NotificationManager
    - 小介面通知UI
    - 未讀提示

### Phase 4: 好感度與學習系統（1週）

**優先級：🟡 高**

11. ✅ **AffectionManager**
    - 好感度計算
    - 關係等級
    - 好感度事件觸發

12. ✅ **LearningManager**
    - 讀書系統
    - 拜師系統
    - 工作實踐成長

13. ✅ **技能系統擴展**
    - 主動技能
    - 被動技能
    - 技能升級

### Phase 5: 派遣系統（1-2週）

**優先級：🟢 中**

14. ✅ **MissionManager**
    - 任務數據定義
    - 任務分配邏輯
    - 進度追蹤

15. ✅ **任務UI**
    - 任務列表
    - 員工選擇介面
    - 進度顯示

16. ✅ **任務事件**
    - 途中隨機事件
    - 戰鬥系統（簡化版）

### Phase 6: 科技樹系統（1週）

**優先級：🟢 中**

17. ✅ **TechnologyManager**
    - 科技樹數據
    - 前置需求驗證
    - 建造/研發進度

18. ✅ **科技樹UI**
    - 樹狀圖顯示
    - 研發介面

19. ✅ **新場景解鎖**
    - 廚房場景
    - 儲藏室場景
    - 客房場景

### Phase 7: 貿易與季節系統（1週）

**優先級：🔵 低**

20. ✅ **季節事件擴展**
    - 季節性商品
    - 季節性事件
    - 價格波動

21. ✅ **商店系統**
    - 物品購買
    - 物品販賣
    - 庫存管理

### Phase 8: 美術與優化（持續）

**優先級：🔵 低**

22. 🎨 **32-bit 像素美術**
    - 角色立繪
    - 場景背景
    - UI 元素
    - 物品圖標

23. 🎵 **音效與音樂**
    - BGM
    - 音效

24. ⚡ **性能優化**
    - 記憶體管理
    - 場景切換優化

---

## 📝 技術注意事項

### 數據結構設計原則

1. **單一數據源（Single Source of Truth）**
   - GameState 是唯一的狀態管理中心
   - 所有管理器都引用 GameState
   - 避免數據重複

2. **事件驅動（Event-Driven）**
   - 使用 EventEmitter 模式
   - 系統間通過事件通信
   - 降低耦合度

3. **可序列化（Serializable）**
   - 所有狀態都可 JSON 序列化
   - 方便存檔/讀檔
   - 避免使用函數引用

### 性能考量

1. **懶加載（Lazy Loading）**
   - 場景資源按需載入
   - 事件數據分批載入

2. **對象池（Object Pooling）**
   - 角色精靈重用
   - 粒子效果重用

3. **數據快取（Caching）**
   - 計算結果快取
   - 避免重複計算

---

## 🎯 下一步行動

### 立即執行

1. **重構 GameState.js**
   - 更新員工數據結構
   - 加入主角系統
   - 加入裝備插槽

2. **創建新管理器**
   - `src/managers/EventManager.js`
   - `src/managers/StoryManager.js`
   - `src/managers/AffectionManager.js`

3. **創建新場景**
   - `src/scenes/StoryScene.js`（視覺小說）
   - `src/scenes/KitchenScene.js`
   - `src/scenes/StorageScene.js`

### 問題與討論

1. **主角名字設定時機？**
   - 開場故事中設定？
   - 遊戲開始前設定？

2. **戰鬥系統深度？**
   - 簡化（數值比較）？
   - 完整（回合制）？

3. **32-bit 像素風格參考？**
   - 有喜歡的遊戲風格嗎？
   - 需要製作美術資源規範文檔嗎？

---

## 📖 附錄

### A. 技能列表示例

```javascript
const SKILLS = {
    // 戰鬥技能
    "skill_sword_basic": {
        name: "基礎劍術",
        type: "active",
        description: "戰鬥力+10%",
        maxLevel: 5
    },

    // 生活技能
    "skill_cooking": {
        name: "烹飪",
        type: "passive",
        description: "廚房工作效率+20%",
        maxLevel: 10
    },

    // 社交技能
    "skill_persuasion": {
        name: "說服",
        type: "active",
        description: "談判成功率+15%",
        maxLevel: 5
    },

    // 管理技能
    "skill_management": {
        name: "經營管理",
        type: "passive",
        description: "客棧收入+5%",
        maxLevel: 10
    }
};
```

### B. 才能列表示例

```javascript
const TALENTS = {
    "talent_born_leader": {
        name: "天生領導",
        description: "管理工作效率+30%，團隊士氣+10",
        rarity: "rare"
    },

    "talent_iron_stomach": {
        name: "鐵胃",
        description: "永不食物中毒，品嘗能力+50%",
        rarity: "uncommon"
    },

    "talent_silver_tongue": {
        name: "三寸不爛之舌",
        description: "說服成功率+25%，好感度獲得+20%",
        rarity: "rare"
    }
};
```

### C. 事件類型分類

1. **隨機事件**
   - 日常小事
   - 客人特殊要求
   - 意外事故

2. **劇情事件**
   - 主線推進
   - 角色支線
   - 世界觀展開

3. **季節事件**
   - 節日慶典
   - 季節限定

4. **好感度事件**
   - 角色專屬
   - 關係發展

5. **任務事件**
   - 委託接取
   - 任務途中

---

**文檔版本**: v2.0
**最後更新**: 2025-10-24
**狀態**: 📝 設計中
