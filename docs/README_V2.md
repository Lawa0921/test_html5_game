# 桌面冒險者 v2.0 - 透明桌面遊戲

一個運行在桌面上的透明視窗掛機養成遊戲。你的角色們會像桌寵一樣在桌面上活動，透過你的日常電腦操作（點擊、打字）來獲得銀兩。

## 遊戲特色

- 🖥️ **透明桌面視窗** - 角色在真實桌面上移動
- 💰 **點擊賺銀兩** - 每次點擊/按鍵都能獲得銀兩
- 👥 **10位角色** - 從主角開始逐步解鎖同伴
- 📈 **角色養成** - 最高升到 Lv.200
- 🏠 **家園建設** - 升級家園獲得銀兩加成
- ⚔️ **隨機事件** - 地下城、寶藏、山賊
- 💾 **自動存檔** - 每30秒自動存檔
- 🌙 **離線收益** - 關閉遊戲也能獲得銀兩

## 快速開始

### 安裝依賴
```bash
npm install
```

### 運行遊戲（推薦方式）

**方式 1：使用啟動腳本（最簡單）**
```bash
./start-v2.sh
```

**方式 2：直接使用 npm**
```bash
npm run start:v2
```

### 開發模式
```bash
npm run dev:v2
```

### 常見問題

**Q: WSL2 環境下如何運行？**

A: WSL2 需要 X Server 支持 GUI。請參考以下步驟：

1. 安裝 Windows 上的 X Server（例如 VcXsrv 或 X410）
2. 在 WSL2 中設置 DISPLAY 環境變量：
   ```bash
   export DISPLAY=$(cat /etc/resolv.conf | grep nameserver | awk '{print $2}'):0
   ```
3. 然後正常運行遊戲

**Q: Docker 方式運行有問題？**

A: 由於 Electron GUI 在 Docker 中的複雜性，我們推薦直接在本機安裝依賴並運行：
```bash
npm install
npm run start:v2
```

## 遊戲操作

### 基礎操作
- **點擊遊戲視窗** - 獲得銀兩
- **按任意鍵** - 獲得銀兩
- **拖曳角色** - 移動角色位置（留下軌跡效果）
- **點擊角色** - 查看角色詳情

### 快捷鍵
- `Ctrl+Shift+D` - 顯示/隱藏遊戲視窗
- `Ctrl+Shift+Q` - 退出遊戲

### 選單功能
點擊右上角 `☰` 按鈕打開選單：
- **家園升級** - 消耗銀兩升級家園，獲得更多銀兩加成
- **裝備商店** - 購買裝備（開發中）
- **寵物商店** - 購買寵物（開發中）
- **角色列表** - 查看所有角色的解鎖狀態
- **統計資料** - 查看遊戲統計
- **存檔** - 手動存檔
- **重置遊戲** - 清除所有進度重新開始

## 角色解鎖條件

| 角色 | 解鎖條件 |
|-----|---------|
| 主角 | 預設解鎖 |
| 法師 | 銀兩達到 1,000 |
| 弓箭手 | 完成第一個地下城 |
| 盜賊 | 觸發寶藏事件 |
| 牧師 | 主角達到 Lv.20 |
| 戰士 | 擊退 10 次山賊 |
| 刺客 | 銀兩達到 10,000 |
| 德魯伊 | 購買第一隻寵物 |
| 武僧 | 完成 5 個背景故事事件 |
| 騎士 | 家園等級達到 5 級 |

## 家園升級

| 等級 | 升級費用 | 銀兩加成 |
|-----|---------|---------|
| 1 | - | +0% |
| 2 | 500 | +10% |
| 3 | 2,000 | +25% |
| 4 | 5,000 | +50% |
| 5 | 10,000 | +100% |
| 6 | 50,000 | +200% |

## 隨機事件

遊戲會隨機觸發以下事件（約每 3-5 分鐘）：

### 🏰 地下城探險
- 獎勵：200 銀兩 + 200 經驗
- 參與角色：前 3 位已解鎖角色

### 💎 發現寶藏
- 獎勵：500 銀兩

### ⚔️ 山賊襲擊
- 獎勵：100 銀兩 + 50 經驗（主角）

## 銀兩系統

### 獲取方式
1. **點擊/按鍵** - 每次基礎 1 銀兩
2. **自動收入** - 每個解鎖角色每秒產生 0.5 銀兩
3. **隨機事件** - 完成事件獲得大量銀兩

### 收入計算
```
實際收入 = 基礎收入 × 家園等級加成 × 寵物加成
```

## 角色升級

### 經驗來源
- 完成事件
- 自動探險（每分鐘獲得經驗）

### 屬性成長（每級）
- 攻擊力 +2
- 防禦力 +1
- 最大血量 +10

## 存檔系統

- **自動存檔** - 每 30 秒
- **手動存檔** - 透過選單
- **退出存檔** - 關閉視窗時自動存檔
- **存檔位置** - localStorage（瀏覽器本地存儲）

### 離線收益
- 離線時間計算上限：8 小時
- 離線期間角色會自動探險
- 重新開啟遊戲時會顯示離線收益彈窗

## 開發相關

### 文件結構
```
├── main-v2.js                 # Electron 主進程（透明視窗版本）
├── index-v2.html              # HTML 入口（透明背景）
├── game-v2.js                 # Phaser 配置（透明渲染）
├── src/
│   ├── core/
│   │   └── GameStateV2.js     # 遊戲狀態管理
│   └── scenes/
│       └── DesktopScene.js    # 桌面主場景
├── ASSETS_REQUIRED.md         # 美術素材需求清單
└── GAME_DESIGN.md             # 遊戲設計文檔
```

### 臨時素材
目前使用簡單的幾何圖形代替美術素材：
- 角色 = 彩色圓形
- UI = 矩形 + 文字
- 特效 = 粒子動畫

### 替換素材
當美術素材準備好後：

1. **角色 Sprite**：放置於 `assets/characters/{name}/`
2. **修改代碼**：在 `DesktopScene.js` 的 `createCharacterSprite()` 方法中替換幾何圖形為 Sprite
3. **動畫配置**：使用 Phaser 的 Sprite Sheet 系統

## 已知問題

1. **透明視窗在某些 Linux 桌面環境可能不支持**
   - 解決方案：調整視窗管理器設置，或使用半透明背景

2. **全局輸入監聽未實現**
   - 目前只監聽遊戲視窗內的輸入
   - 未來可使用 `uiohook-napi` 實現全局監聽

3. **WSL2 + Docker 運行需要 X Server**
   - 參考 `RUN.md` 配置 X11 轉發

## 下一步開發計劃

- [ ] 裝備系統
- [ ] 寵物系統
- [ ] 背景故事事件
- [ ] 角色大絕招動畫
- [ ] 音效系統
- [ ] 成就系統
- [ ] 全局輸入監聽

## 技術棧

- **桌面框架**: Electron 38.3.0 (2025 年最新穩定版)
  - Chromium 140.0.7339.240
  - Node.js 22.20.0
- **遊戲引擎**: Phaser 3.90.0 (v3 系列最後版本)
- **測試框架**: Vitest 3.2.0
- **打包工具**: electron-builder 26.1.0
- **語言**: JavaScript (ES6+)
- **Docker**: Node.js 22 on Debian 12 (bookworm)

> 所有依賴項已更新到 2025 年 10 月最新穩定版本。詳見 `DEPENDENCIES.md`

## License

MIT

---

## 舊版本

如果想運行原始版本（戰鬥場景原型）：
```bash
npm start
```

查看 `README.md` 了解舊版本詳情。
