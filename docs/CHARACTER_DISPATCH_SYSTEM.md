# 角色派遣系統設計文檔

> 讓每個角色都可以執行客棧的各種工作，增加遊戲靈活性和策略性

---

## 🎯 核心概念

### 設計理念
**所有角色都可以被派遣去執行客棧工作**，但效率和質量會根據角色的專長而有所不同。

- 林語嫣做菜 → 質量：⭐⭐⭐⭐⭐（專業廚師）
- 林修然做菜 → 質量：⭐⭐⭐（掌櫃會基礎烹飪）
- 蕭鐵峰做菜 → 質量：⭐（粗人做菜）

### 遊戲性優勢
1. **靈活性**：可根據情況調整人力分配
2. **策略性**：需要考慮角色技能和效率
3. **緊急應變**：主廚生病時可臨時調人
4. **角色培養**：非專業角色可通過練習提升技能

---

## 📋 派遣工作類型

### 一、烹飪相關

#### 1.1 做菜（cooking）
**可派遣角色**：全角色
**動畫**：切菜 → 翻炒 → 出鍋（6幀循環）

| 角色 | 熟練度 | 速度 | 質量 | 特殊效果 |
|------|--------|------|------|----------|
| 林語嫣 | ⭐⭐⭐⭐⭐ | 快 | 極高 | 偶爾做出特殊菜餚 |
| 林修然 | ⭐⭐⭐ | 普通 | 中等 | - |
| 溫如玉 | ⭐⭐⭐⭐ | 快 | 高 | 擅長點心 |
| 顧青鸞 | ⭐⭐⭐ | 普通 | 中等 | 擅長藥膳 |
| 蘇妙音 | ⭐⭐ | 慢 | 低 | - |
| 翠兒 | ⭐⭐ | 慢 | 低 | 可能燒焦 |
| 秦婉柔 | ⭐⭐ | 慢 | 低 | - |
| 沈青山 | ⭐⭐⭐⭐ | 普通 | 高 | 宮廷菜式 |
| 蕭鐵峰 | ⭐ | 慢 | 很低 | 粗糙但能吃 |
| 方無忌 | ⭐⭐ | 慢 | 低 | - |
| 李默然 | ⭐⭐ | 慢 | 低 | 精於計算食材成本 |

#### 1.2 備菜（prep）
**可派遣角色**：全角色
**動畫**：切菜/洗菜/準備（6幀循環）

所有角色都可以執行，但速度不同。

#### 1.3 端菜（serving）
**可派遣角色**：全角色
**動畫**：端盤 → 行走 → 放下（6幀循環）

| 角色 | 熟練度 | 速度 | 特殊 |
|------|--------|------|------|
| 溫如玉 | ⭐⭐⭐⭐⭐ | 極快 | 專業服務 |
| 翠兒 | ⭐⭐⭐⭐ | 快 | 活潑可愛 |
| 林修然 | ⭐⭐⭐ | 普通 | - |
| 其他 | ⭐⭐ | 慢 | 可能打翻 |

---

### 二、服務相關

#### 2.1 迎賓（greeting）
**可派遣角色**：全角色
**動畫**：鞠躬/招手（3幀）

| 角色 | 效果 |
|------|------|
| 林修然 | 標準，客人滿意度 +5 |
| 溫如玉 | 優雅，客人滿意度 +10 |
| 翠兒 | 可愛，客人滿意度 +8 |
| 蘇妙音 | 魅惑，客人滿意度 +12（男客人）|
| 秦婉柔 | 溫柔，客人滿意度 +10 |
| 蕭鐵峰 | 威嚴，客人滿意度 +3（可能嚇到客人）|

#### 2.2 打掃（cleaning）
**可派遣角色**：全角色
**動畫**：掃地/擦拭（6幀循環）

所有角色都可執行，效率相近。

#### 2.3 整理房間（tidying）
**可派遣角色**：全角色
**動畫**：整理床鋪/擺放物品（6幀循環）

溫如玉、林語嫣較擅長。

---

### 三、特殊工作

#### 3.1 演奏（performing）
**可派遣角色**：蘇妙音、秦婉柔、方無忌
**動畫**：彈琴/說書（6幀循環）

| 角色 | 效果 |
|------|------|
| 蘇妙音 | 客人滿意度 +15，收入 +20% |
| 秦婉柔 | 客人滿意度 +12，收入 +15% |
| 方無忌 | 客人滿意度 +10，可能觸發情報事件 |

#### 3.2 治療（healing）
**可派遣角色**：顧青鸞、林語嫣（藥膳）
**動畫**：診脈/配藥（6幀）

顧青鸞專業，林語嫣只能做藥膳。

#### 3.3 保安（security）
**可派遣角色**：蕭鐵峰、翠兒、林修然
**動畫**：巡邏/警戒（6幀循環）

| 角色 | 效果 |
|------|------|
| 蕭鐵峰 | 戰鬥力 100，嚇退小賊 |
| 翠兒 | 戰鬥力 60，發現可疑人物 |
| 林修然 | 戰鬥力 40，基礎巡邏 |

#### 3.4 記賬（accounting）
**可派遣角色**：李默然、林修然、沈青山
**動畫**：打算盤/寫賬本（6幀循環）

| 角色 | 效果 |
|------|------|
| 李默然 | 發現節省成本的機會 +10% |
| 林修然 | 標準記賬 |
| 沈青山 | 偶爾給出經營建議 |

---

## 🎨 幀動畫資源規劃

### 動畫標準
- **幀率**：6 FPS（每秒6幀）
- **短動作**：3幀（0.5秒）
- **標準動作**：6幀（1秒）
- **循環動作**：6-12幀

### 動畫類型分類

#### A類：通用動作（所有角色需要）
每個動作 × 11個角色 = 大量資源

| 動作 | 幀數 | 角色數 | 總幀數 | 優先級 |
|------|------|--------|--------|--------|
| 做菜（cooking） | 6幀循環 | 11 | 66幀 | 🔴 最高 |
| 端菜（serving） | 6幀循環 | 11 | 66幀 | 🔴 最高 |
| 打掃（cleaning） | 6幀循環 | 11 | 66幀 | 🔴 高 |
| 迎賓（greeting） | 3幀 | 11 | 33幀 | 🔴 高 |
| 行走（walking） | 6幀循環 | 11 | 66幀 | 🔴 最高 |

**A類小計**：297幀

#### B類：職業專屬動作（特定角色）
| 動作 | 幀數 | 需要角色 | 總幀數 | 優先級 |
|------|------|----------|--------|--------|
| 彈琴（qin） | 6幀循環 | 2（蘇妙音、秦婉柔） | 12幀 | 🔴 高 |
| 診脈（diagnose） | 6幀 | 1（顧青鸞） | 6幀 | 🟡 中 |
| 配藥（medicine） | 6幀循環 | 1（顧青鸞） | 6幀 | 🟡 中 |
| 說書（storytelling） | 6幀循環 | 1（方無忌） | 6幀 | 🟡 中 |
| 記賬（accounting） | 6幀循環 | 3（李默然、林修然、沈青山） | 18幀 | 🟡 中 |
| 練劍（sword_practice） | 6幀循環 | 2（翠兒、蕭鐵峰） | 12幀 | 🟢 低 |

**B類小計**：60幀

#### C類：戰鬥動作（戰鬥角色）
| 動作 | 幀數 | 需要角色 | 總幀數 | 優先級 |
|------|------|----------|--------|--------|
| 攻擊（attack） | 6幀 | 5（蕭鐵峰、翠兒、顧青鸞、蘇妙音、林修然） | 30幀 | 🔴 高 |
| 防禦（defend） | 3幀 | 5 | 15幀 | 🟡 中 |
| 受擊（hit） | 3幀 | 5 | 15幀 | 🟡 中 |
| 倒地（defeat） | 3幀 | 5 | 15幀 | 🟡 中 |
| 勝利（victory） | 3幀 | 5 | 15幀 | 🟢 低 |

**C類小計**：90幀

#### D類：情感動作（戀愛/劇情）
| 動作 | 幀數 | 需要角色 | 總幀數 | 優先級 |
|------|------|----------|--------|--------|
| 擁抱（hug） | 6幀 | 5（可攻略女角） | 30幀 | 🟡 中 |
| 牽手（hold_hands） | 3幀 | 5 | 15幀 | 🟡 中 |
| 哭泣（crying） | 6幀循環 | 3（林語嫣、秦婉柔、溫如玉） | 18幀 | 🟡 中 |
| 驚訝（surprised） | 3幀 | 11 | 33幀 | 🟡 中 |

**D類小計**：96幀

---

### 幀動畫總計

| 類別 | 幀數 | 優先級分布 |
|------|------|-----------|
| A類：通用動作 | 297幀 | 🔴 最高 |
| B類：職業專屬 | 60幀 | 🟡 中 |
| C類：戰鬥動作 | 90幀 | 🔴 高 |
| D類：情感動作 | 96幀 | 🟡 中 |
| **總計** | **543幀** | |

---

## 🎯 優先級製作順序

### 第一階段：核心動畫（120幀）🔴
**時間**：2-3週

**必須完成**：
1. **做菜動畫**（6幀 × 5個主要角色）= 30幀
   - 林語嫣、林修然、溫如玉、顧青鸞、沈青山
2. **端菜動畫**（6幀 × 3個服務角色）= 18幀
   - 溫如玉、翠兒、林修然
3. **行走動畫**（6幀 × 11個角色）= 66幀
   - 全角色通用
4. **迎賓動畫**（3幀 × 2個角色）= 6幀
   - 林修然、溫如玉

**這120幀可以支撐基本玩法！**

### 第二階段：擴展動畫（200幀）🟡
**時間**：3-4週

1. 完整做菜動畫（剩餘6個角色）
2. 完整端菜動畫（剩餘8個角色）
3. 打掃動畫（全角色）
4. 迎賓動畫（剩餘角色）
5. 職業專屬動作（彈琴、診脈、記賬等）

### 第三階段：戰鬥與情感（223幀）🟢
**時間**：4-6週

1. 完整戰鬥動作序列
2. 情感動作（擁抱、牽手、哭泣等）
3. 特殊劇情動作

---

## 💾 資源命名規範

### 幀動畫命名格式
```
{角色ID}_{角色名}_{動作}_{幀編號}.png

範例：
001_林修然_cooking_01.png
001_林修然_cooking_02.png
...
001_林修然_cooking_06.png

002_林語嫣_serving_01.png
002_林語嫣_serving_02.png
...
```

### 目錄結構
```
assets/
└── characters/
    └── animations/
        ├── 001_林修然/
        │   ├── cooking/       # 做菜動畫（6幀）
        │   ├── serving/       # 端菜動畫（6幀）
        │   ├── walking/       # 行走動畫（6幀）
        │   └── greeting/      # 迎賓動畫（3幀）
        ├── 002_林語嫣/
        │   ├── cooking/
        │   ├── serving/
        │   └── ...
        └── ...
```

---

## 🎮 遊戲系統實現

### 派遣系統接口

```javascript
// 派遣角色執行工作
class CharacterDispatchManager {
  /**
   * 派遣角色
   * @param {string} characterId - 角色ID
   * @param {string} taskType - 任務類型（cooking/serving/cleaning等）
   * @param {object} options - 額外選項
   */
  dispatch(characterId, taskType, options = {}) {
    const character = this.getCharacter(characterId);
    const task = this.createTask(taskType, character, options);

    // 計算效率
    const efficiency = this.calculateEfficiency(character, taskType);

    // 播放動畫
    this.playAnimation(character, taskType);

    // 執行任務
    return this.executeTask(task, efficiency);
  }

  /**
   * 計算角色執行任務的效率
   */
  calculateEfficiency(character, taskType) {
    const baseSkill = character.skills[taskType] || 1; // 1-5星
    const experience = character.experience[taskType] || 0;
    const fatigue = character.fatigue; // 疲勞度影響效率

    return {
      speed: baseSkill * (1 + experience * 0.1) * (1 - fatigue * 0.2),
      quality: baseSkill * (1 + experience * 0.15),
      successRate: Math.min(0.95, 0.5 + baseSkill * 0.1 + experience * 0.05)
    };
  }

  /**
   * 播放角色動畫
   */
  playAnimation(character, taskType) {
    const animPath = `assets/characters/animations/${character.id}_${character.name}/${taskType}/`;
    const frameCount = this.getAnimationFrameCount(taskType);

    return this.animationManager.play({
      path: animPath,
      frames: frameCount,
      fps: 6,
      loop: this.isLoopAnimation(taskType)
    });
  }
}
```

### 技能成長系統

```javascript
/**
 * 角色執行任務後獲得經驗
 */
gainExperience(characterId, taskType, success) {
  const character = this.getCharacter(characterId);

  if (!character.experience) {
    character.experience = {};
  }

  // 基礎經驗值
  let exp = success ? 10 : 5;

  // 非專業工作獲得更多經驗（學習曲線）
  if (character.skills[taskType] < 3) {
    exp *= 1.5;
  }

  character.experience[taskType] = (character.experience[taskType] || 0) + exp;

  // 升級判定
  if (character.experience[taskType] >= 100) {
    this.levelUpSkill(character, taskType);
  }
}

/**
 * 技能升級
 */
levelUpSkill(character, taskType) {
  if (character.skills[taskType] < 5) {
    character.skills[taskType] += 1;
    character.experience[taskType] = 0;

    this.notificationManager.success(
      '技能提升',
      `${character.name} 的 ${taskType} 技能提升至 ${character.skills[taskType]} 星！`
    );
  }
}
```

---

## 📊 資源更新統計

### 原有資源（ASSETS_CHECKLIST.md）
- 角色立繪：60張（已規劃）
- 角色表情：205張（已規劃）
- 道具圖標：170種（已規劃）
- CG圖：72張（已規劃）
- 特效：95張（已規劃）

### 新增幀動畫資源
- **幀動畫**：543幀（新增）

### 最終總計
- **原有資源**：602張
- **新增動畫**：543幀
- **總計**：**1145張圖片資源**

---

## 🎨 動畫製作規範

### 幀動畫製作標準

#### 尺寸規格
- **角色尺寸**：與立繪相同（800x1200px）
- **實際動畫區域**：可能更小，留白部分透明
- **對齊方式**：底部中心對齊（便於位置定位）

#### 風格一致性
- 與立繪風格完全一致
- 線條粗細統一
- 色彩保持一致
- 陰影處理統一

#### 動畫流暢度
- 6 FPS 對於2D遊戲足夠流暢
- 循環動畫需要首尾銜接
- 關鍵幀要明確（起始、中間、結束）

### 製作工具建議（32bit 2D 風格）
1. **Aseprite**：專業像素動畫工具（推薦）
2. **Krita**：免費繪圖軟件，支持動畫時間軸
3. **Adobe Animate**：傳統 2D 動畫製作
4. **Clip Studio Paint**：動畫功能強大，適合繪師
5. **Photoshop**：逐幀動畫製作（傳統方式）

### 優化建議（32bit 2D 逐幀動畫）
1. **模組化分層繪製**：
   - 身體部位（頭/身體/四肢）分離圖層
   - 可替換服裝、髮型、表情
   - 提高資源利用率和迭代效率

2. **動作復用策略**：
   - 相似動作共用幀序列（如左右揮舞）
   - 鏡像翻轉減少50%繪製量
   - 速度調整創造變化（同樣的幀用不同播放速度）

3. **幀數優化原則**：
   - 關鍵幀先行製作（起始、極限位置、結束）
   - 循環動作重複首尾幀實現無縫銜接
   - 6 FPS 已足夠流暢（24 FPS 對2D遊戲太高）

---

## 📈 開發時程預估

### 完整動畫製作時程

| 階段 | 內容 | 幀數 | 預估時間 |
|------|------|------|----------|
| 階段1 | 核心動畫 | 120幀 | 2-3週 |
| 階段2 | 擴展動畫 | 200幀 | 3-4週 |
| 階段3 | 戰鬥情感 | 223幀 | 4-6週 |
| **總計** | | **543幀** | **9-13週（2-3個月）** |

### 成本估算（外包）
假設每幀 2D 動畫 $10-20（32bit 精細繪製）：
- 543幀 × $15（平均）= **$8,145**
- 優先製作 120 幀核心動畫：約 **$1,800**
- 像素風格可降低成本 30-40%

---

## 🎯 關鍵設計決策

### 為什麼選擇6 FPS？
1. **文件大小**：相比24/30fps，文件大小減少75-80%
2. **製作成本**：製作時間和成本大幅降低
3. **視覺效果**：對於2D遊戲，6fps已足夠流暢
4. **業界標準**：大部分2D獨立遊戲使用6-12fps

### 為什麼所有角色都能做所有事？
1. **遊戲性**：增加策略深度和靈活性
2. **緊急應變**：主要角色缺席時有替代方案
3. **角色培養**：玩家可以培養喜歡的角色
4. **真實感**：客棧經營中確實會出現人手調度問題

---

## 🔗 相關文檔

- 角色背景設定：`docs/characters/*.md`
- 靜態資源清單：`docs/ASSETS_CHECKLIST.md`
- 動作道具清單：`docs/ANIMATION_AND_ITEMS_CHECKLIST.md`
- 資源載入器：`src/utils/AssetLoader.js`

---

**文檔版本**：V1.0
**創建日期**：2025-01-24
**動畫資源總計**：543幀（32bit 2D 逐幀動畫）
**優先製作**：120幀核心動畫
**預估製作時間**：3-4個月（逐幀繪製）
**預估成本**：$8,000-10,000（完整）/ $1,800-2,500（核心動畫）
