# 變更日誌

本文檔記錄專案的所有重要變更。

## [Unreleased] - 2025-10-22

### 🚀 重大更新：依賴項升級到 2025 年最新版本

#### 升級的依賴項

**核心依賴**
- Phaser: `3.70.0` → `3.90.0` (+20 次版本)
  - 效能改進和錯誤修復
  - Phaser v3 系列的最後一個穩定版本

**開發依賴**
- Electron: `28.0.0` → `38.3.0` (+10 主版本)
  - Chromium: 120.x → 140.0.7339.240
  - Node.js: 18.x → 22.20.0
  - 效能和安全性大幅提升

- Vitest: `1.0.0` → `3.2.0` (+2 主版本)
  - 改進的瀏覽器模式
  - 增強的 TypeScript 支援
  - 重新設計的報告 API

- electron-builder: `24.9.1` → `26.1.0` (+1 主版本)
  - 支援最新的 Electron 版本
  - 改進的打包效能

**基礎設施**
- Node.js: `20` → `22` (Active LTS)
- Docker 基礎鏡像: `node:20-bullseye` → `node:22-bookworm`
- Debian: 11 (bullseye) → 12 (bookworm)

#### 新增文檔

- ✨ **DEPENDENCIES.md**: 依賴項版本說明和相容性矩陣
- ✨ **UPGRADE_GUIDE.md**: 詳細的升級步驟和驗證清單
- ✨ **CHANGELOG.md**: 變更日誌（本文件）

#### 更新的文檔

- 📝 **README_V2.md**: 更新技術棧章節，反映最新依賴版本
- 📝 **Dockerfile**: 升級到 Node.js 22 和 Debian 12

#### 測試狀態

- ✅ 所有 23 個單元測試通過
- ✅ GameStateV2 核心邏輯驗證通過
- ✅ 升級系統測試通過（Lv.1-200+）
- ✅ 離線收益計算測試通過

#### 已知相容性

- ✅ Linux (Debian 12) - 完全相容
- ✅ Node.js 22.20.0 - 完全相容
- ⚠️ WSL2 - 需要 X Server 或 WSLg（已文檔化）
- ⚠️ macOS/Windows - 理論上相容，未測試

### 🔧 改進

- 效能提升得益於 Chromium 和 Node.js 的升級
- 更好的安全性和穩定性
- 與最新瀏覽器標準的相容性

### 📚 文檔改進

- 新增完整的依賴管理文檔
- 新增升級指南和回滾策略
- 改進 README 中的技術棧說明

### ⚠️ 注意事項

**無破壞性變更**
- 所有 API 保持向後相容
- 遊戲邏輯無需修改
- 測試全部通過

**推薦操作**
```bash
# 清理舊依賴
rm -rf node_modules package-lock.json

# 重新安裝
npm install

# 驗證
npm test
npm run start:v2
```

---

## [0.1.0] - 2025-10-22

### ✨ 初始版本：桌面冒險者 v2.0

#### 核心功能

**遊戲系統**
- ✅ 10 個角色系統（主角 + 9 位同伴）
- ✅ 角色升級系統（Lv.1-200）
- ✅ 點擊/按鍵賺取銀兩機制
- ✅ 家園升級系統（6 級）
- ✅ 隨機事件系統（地下城、寶藏、山賊）
- ✅ 角色解鎖條件系統
- ✅ 存檔/讀檔系統（localStorage）
- ✅ 離線收益計算（最多 8 小時）

**UI/UX**
- ✅ 透明桌面視窗
- ✅ 可拖曳角色（附帶粒子軌跡效果）
- ✅ 完整選單系統
  - 家園升級
  - 裝備商店（UI 完成，功能待實作）
  - 寵物商店（UI 完成，功能待實作）
  - 角色列表
  - 統計資料
  - 存檔
  - 重置遊戲
- ✅ 事件彈窗系統
- ✅ 角色詳情面板
- ✅ 離線收益彈窗
- ✅ 點擊特效（飛行文字 + 粒子）

**技術實現**
- ✅ Electron 透明視窗配置
- ✅ Phaser 3 遊戲引擎整合
- ✅ 數據驅動架構（GameStateV2）
- ✅ 完整的單元測試覆蓋
- ✅ Docker 開發環境
- ✅ 多平台打包配置

**文檔**
- ✅ README_V2.md - 完整遊戲說明
- ✅ GAME_DESIGN.md - 遊戲設計文檔
- ✅ ASSETS_REQUIRED.md - 美術素材需求清單
- ✅ CLAUDE.md - 專案架構說明

#### 快捷鍵

- `Ctrl+Shift+D` - 顯示/隱藏遊戲視窗
- `Ctrl+Shift+Q` - 退出遊戲

#### 角色列表

1. **主角** (預設解鎖)
2. **法師** (銀兩達到 1,000)
3. **弓箭手** (完成第一個地下城)
4. **盜賊** (觸發寶藏事件)
5. **牧師** (主角達到 Lv.20)
6. **戰士** (擊退 10 次山賊)
7. **刺客** (銀兩達到 10,000)
8. **德魯伊** (購買第一隻寵物)
9. **武僧** (完成 5 個背景故事事件)
10. **騎士** (家園等級達到 5 級)

#### 家園升級

| 等級 | 費用 | 銀兩加成 |
|------|------|----------|
| 1 | - | +0% |
| 2 | 500 | +10% |
| 3 | 2,000 | +25% |
| 4 | 5,000 | +50% |
| 5 | 10,000 | +100% |
| 6 | 50,000 | +200% |

#### 測試覆蓋

- ✅ 遊戲狀態初始化
- ✅ 銀兩獲取和消費
- ✅ 角色解鎖邏輯
- ✅ 角色升級系統
- ✅ 家園升級系統
- ✅ 離線掛機計算
- ✅ 存檔/讀檔功能

**測試統計**: 23 passed | 6 todo

#### 已知限制

- 🎨 使用臨時幾何圖形代替美術素材
- ⚠️ 裝備系統 UI 完成，邏輯待實作
- ⚠️ 寵物系統 UI 完成，邏輯待實作
- ⚠️ 背景故事事件結構存在，內容待填充
- ⚠️ 全局輸入監聽未實作（僅監聽遊戲視窗）

#### 啟動方式

```bash
# 方式 1: 使用啟動腳本（推薦）
./start-v2.sh

# 方式 2: 直接使用 npm
npm run start:v2

# 開發模式
npm run dev:v2
```

#### 技術棧

- Electron 28.0.0 (後升級到 38.3.0)
- Phaser 3.70.0 (後升級到 3.90.0)
- Vitest 1.0.0 (後升級到 3.2.0)
- Node.js 20 (後升級到 22)

---

## 版本規範

我們遵循 [語義化版本](https://semver.org/lang/zh-TW/)：

- **MAJOR** (主版本): 不相容的 API 變更
- **MINOR** (次版本): 向後相容的功能新增
- **PATCH** (修訂版本): 向後相容的問題修正

## 圖例

- ✨ 新功能
- 🔧 改進
- 🐛 錯誤修復
- 📝 文檔
- ⚠️ 警告/注意事項
- 🚨 破壞性變更
- 🔥 移除功能
- 🎨 UI/UX 改進
- ⚡ 效能改進
- 🔒 安全性
